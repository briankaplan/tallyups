<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="Tallyups Reports Dashboard - Track and manage your expense reports">
<meta name="theme-color" content="#0a0f14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Reports - Tallyups</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“Š</text></svg>">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="/static/tallyups-design.css">
<style>
/* ============================================
   REPORTS DASHBOARD - PREMIUM DESIGN
   ============================================ */

/* Override body for this page */
body {
  background: var(--bg);
  min-height: 100vh;
}

.reports-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  padding-bottom: 100px;
}

/* Page Header */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  flex-wrap: wrap;
  gap: 16px;
}

.page-title {
  display: flex;
  align-items: center;
  gap: 12px;
}

.page-title h1 {
  font-size: 28px;
  font-weight: 700;
  margin: 0;
}

.page-title .badge {
  background: var(--brand-dim);
  color: var(--brand);
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.header-actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

.btn-new-report {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  background: linear-gradient(135deg, var(--brand), #00cc6a);
  color: #000;
  border: none;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 4px 16px rgba(0,255,136,0.3);
}

.btn-new-report:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 24px rgba(0,255,136,0.4);
}

.date-selector {
  display: flex;
  gap: 4px;
  background: var(--bg-card);
  border-radius: 10px;
  padding: 4px;
  border: 1px solid var(--border);
}

.date-btn {
  padding: 8px 16px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 13px;
  font-weight: 500;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.date-btn:hover {
  background: var(--bg-hover);
  color: var(--text);
}

.date-btn.active {
  background: var(--brand-dim);
  color: var(--brand);
}

/* Stats Cards Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 32px;
}

@media (max-width: 1024px) {
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 600px) {
  .stats-grid { grid-template-columns: 1fr; }
}

.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 20px;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--brand), transparent);
  opacity: 0;
  transition: opacity 0.2s;
}

.stat-card:hover::before {
  opacity: 1;
}

.stat-card.highlight {
  background: linear-gradient(135deg, rgba(0,255,136,0.1), var(--bg-card));
  border-color: rgba(0,255,136,0.3);
}

.stat-card.highlight::before {
  opacity: 1;
}

.stat-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.stat-value {
  font-size: 32px;
  font-weight: 800;
  color: var(--text);
  margin-bottom: 4px;
  font-family: 'SF Mono', Monaco, Consolas, monospace;
}

.stat-card.highlight .stat-value {
  background: linear-gradient(135deg, var(--brand), #00cc6a);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.stat-change {
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
}

.stat-change.positive { color: var(--brand); }
.stat-change.negative { color: var(--error); }
.stat-change.neutral { color: var(--text-secondary); }

/* Charts Section */
.charts-section {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 24px;
  margin-bottom: 32px;
}

@media (max-width: 1024px) {
  .charts-section { grid-template-columns: 1fr; }
}

.chart-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.chart-title {
  font-size: 16px;
  font-weight: 700;
}

.chart-toggle {
  display: flex;
  gap: 4px;
  background: var(--bg);
  border-radius: 8px;
  padding: 3px;
}

.chart-toggle-btn {
  padding: 6px 12px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 12px;
  font-weight: 500;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}

.chart-toggle-btn:hover {
  color: var(--text);
}

.chart-toggle-btn.active {
  background: var(--bg-card);
  color: var(--brand);
}

.chart-container {
  position: relative;
  height: 250px;
}

/* Business Breakdown */
.business-section {
  margin-bottom: 32px;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.section-title {
  font-size: 18px;
  font-weight: 700;
}

.business-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
}

.business-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}

.business-card:hover {
  border-color: var(--brand);
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
}

.business-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.business-name {
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
}

.business-badge {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
}

.business-badge.down-home { background: rgba(0,255,136,0.2); color: #00ff88; }
.business-badge.mcr { background: rgba(255,216,94,0.2); color: #ffd85e; }
.business-badge.personal { background: rgba(110,181,255,0.2); color: #6eb5ff; }
.business-badge.other { background: rgba(136,136,136,0.2); color: #888; }

.business-amount {
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 4px;
  font-family: 'SF Mono', Monaco, monospace;
}

.business-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.business-count {
  font-size: 13px;
  color: var(--text-secondary);
}

.business-percent {
  font-size: 13px;
  font-weight: 600;
  color: var(--brand);
}

.business-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--brand), #00cc6a);
  transition: width 0.5s ease;
}

/* Reports List */
.reports-section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
}

.reports-tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  background: var(--bg-elevated);
}

.reports-tab {
  padding: 16px 20px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  position: relative;
  transition: all 0.2s;
}

.reports-tab:hover {
  color: var(--text);
}

.reports-tab.active {
  color: var(--brand);
}

.reports-tab.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 20px;
  right: 20px;
  height: 2px;
  background: var(--brand);
  border-radius: 1px 1px 0 0;
}

.reports-tab .count {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 20px;
  height: 20px;
  background: var(--bg-card);
  border-radius: 10px;
  font-size: 11px;
  margin-left: 6px;
  padding: 0 6px;
}

.reports-tab.active .count {
  background: var(--brand-dim);
  color: var(--brand);
}

.reports-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  gap: 12px;
  flex-wrap: wrap;
}

.search-box {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 8px 14px;
  flex: 1;
  max-width: 300px;
}

.search-box:focus-within {
  border-color: var(--brand);
}

.search-box input {
  background: transparent;
  border: none;
  color: var(--text);
  font-size: 14px;
  width: 100%;
  outline: none;
}

.search-box input::placeholder {
  color: var(--text-muted);
}

.search-box svg {
  width: 16px;
  height: 16px;
  color: var(--text-muted);
  flex-shrink: 0;
}

.toolbar-actions {
  display: flex;
  gap: 8px;
}

.toolbar-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text-secondary);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.toolbar-btn:hover {
  background: var(--bg-hover);
  color: var(--text);
  border-color: var(--border-light);
}

/* Reports Table */
.reports-table {
  width: 100%;
  border-collapse: collapse;
}

.reports-table th {
  text-align: left;
  padding: 14px 20px;
  font-size: 11px;
  font-weight: 700;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
}

.reports-table th.sortable {
  cursor: pointer;
  user-select: none;
}

.reports-table th.sortable:hover {
  color: var(--text-secondary);
}

.reports-table th.sortable svg {
  width: 12px;
  height: 12px;
  vertical-align: middle;
  margin-left: 4px;
  opacity: 0.5;
}

.reports-table th.sorted svg {
  opacity: 1;
  color: var(--brand);
}

.reports-table td {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  font-size: 14px;
}

.reports-table tbody tr {
  cursor: pointer;
  transition: background 0.15s;
}

.reports-table tbody tr:hover {
  background: var(--bg-hover);
}

.reports-table tbody tr:last-child td {
  border-bottom: none;
}

.report-name {
  font-weight: 600;
  color: var(--text);
}

.report-date {
  color: var(--text-secondary);
  font-size: 13px;
}

.report-amount {
  font-family: 'SF Mono', Monaco, monospace;
  font-weight: 700;
  color: var(--brand);
}

.report-count {
  color: var(--text-secondary);
}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
}

.status-badge.draft {
  background: rgba(255,216,94,0.15);
  color: #ffd85e;
}

.status-badge.submitted {
  background: rgba(0,255,136,0.15);
  color: #00ff88;
}

.status-badge.pending {
  background: rgba(110,181,255,0.15);
  color: #6eb5ff;
}

.report-actions {
  display: flex;
  gap: 4px;
  opacity: 0;
  transition: opacity 0.15s;
}

.reports-table tbody tr:hover .report-actions {
  opacity: 1;
}

.action-btn {
  width: 32px;
  height: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid transparent;
  border-radius: 8px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.15s;
}

.action-btn:hover {
  background: var(--bg-card);
  border-color: var(--border);
  color: var(--text);
}

.action-btn svg {
  width: 16px;
  height: 16px;
}

/* Empty State */
.empty-state {
  padding: 60px 20px;
  text-align: center;
}

.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.empty-title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 8px;
}

.empty-text {
  color: var(--text-secondary);
  margin-bottom: 24px;
  max-width: 400px;
  margin-left: auto;
  margin-right: auto;
}

/* Loading State */
.loading-spinner {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
}

.spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--border);
  border-top-color: var(--brand);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* New Report Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s;
}

.modal-overlay.visible {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 20px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow: hidden;
  transform: scale(0.95) translateY(20px);
  transition: transform 0.3s;
}

.modal-overlay.visible .modal {
  transform: scale(1) translateY(0);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
}

.modal-title {
  font-size: 18px;
  font-weight: 700;
}

.modal-close {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.2s;
}

.modal-close:hover {
  background: var(--bg-hover);
  color: var(--text);
}

.modal-body {
  padding: 24px;
}

.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-size: 14px;
  transition: border-color 0.2s;
}

.form-input:focus {
  outline: none;
  border-color: var(--brand);
}

.form-input::placeholder {
  color: var(--text-muted);
}

.form-select {
  width: 100%;
  padding: 12px 16px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-size: 14px;
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
}

.form-select:focus {
  outline: none;
  border-color: var(--brand);
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding: 20px 24px;
  border-top: 1px solid var(--border);
  background: var(--bg);
}

.btn-cancel {
  padding: 12px 24px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-cancel:hover {
  background: var(--bg-hover);
  color: var(--text);
}

.btn-create {
  padding: 12px 24px;
  background: linear-gradient(135deg, var(--brand), #00cc6a);
  border: none;
  border-radius: 10px;
  color: #000;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-create:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(0,255,136,0.3);
}

/* Mobile Navigation */
@media (max-width: 768px) {
  .reports-container { padding: 16px; }
  .page-header { margin-bottom: 20px; }
  .page-title h1 { font-size: 22px; }
  .stat-value { font-size: 24px; }
  .charts-section { gap: 16px; }
  .chart-container { height: 200px; }
  .business-amount { font-size: 22px; }
  .reports-tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .reports-table { font-size: 13px; }
  .reports-table th, .reports-table td { padding: 12px 16px; }
  .date-selector { display: none; }
}

/* Skeleton loading */
.skeleton {
  background: linear-gradient(90deg, var(--bg-card) 25%, var(--bg-hover) 50%, var(--bg-card) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}
</style>
</head>
<body>
  <!-- Site Header (from shared design system) -->
  <header class="site-header">
    <div class="site-header-content">
      <div class="site-brand">
        <h1>ðŸ§¾ Tallyups</h1>
        <span class="version">v2.0</span>
      </div>
      <nav class="header-nav">
        <a href="/" class="nav-link-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Home
        </a>
        <a href="/viewer" class="nav-link-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
          Reconcile
        </a>
        <a href="/reports" class="nav-link-btn active">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
          Reports
        </a>
        <a href="/scanner" class="nav-link-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
          Scan
        </a>
        <a href="/incoming" class="nav-link-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>
          Inbox
        </a>
      </nav>
    </div>
  </header>

  <main class="reports-container">
    <!-- Page Header -->
    <div class="page-header">
      <div class="page-title">
        <h1>Reports</h1>
        <span class="badge" id="ytd-badge">2025 YTD</span>
      </div>
      <div class="header-actions">
        <div class="date-selector">
          <button class="date-btn" data-range="month">This Month</button>
          <button class="date-btn" data-range="quarter">Quarter</button>
          <button class="date-btn active" data-range="ytd">YTD</button>
          <button class="date-btn" data-range="all">All Time</button>
        </div>
        <button class="btn-new-report" onclick="showNewReportModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          New Report
        </button>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card highlight">
        <div class="stat-label">Total Expenses</div>
        <div class="stat-value" id="stat-total-amount">$0</div>
        <div class="stat-change neutral" id="stat-total-change">
          <span id="stat-total-count">0</span> transactions YTD
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Reports Filed</div>
        <div class="stat-value" id="stat-report-count">0</div>
        <div class="stat-change neutral" id="stat-report-change">
          <span id="stat-reports-month">0</span> this month
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Receipt Coverage</div>
        <div class="stat-value" id="stat-coverage">0%</div>
        <div class="stat-change neutral" id="stat-missing">
          <span id="stat-missing-count">0</span> missing
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Pending Review</div>
        <div class="stat-value" id="stat-pending">0</div>
        <div class="stat-change neutral">
          Needs attention
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">Spending Trend</div>
          <div class="chart-toggle">
            <button class="chart-toggle-btn active" data-view="amount">Amount</button>
            <button class="chart-toggle-btn" data-view="count">Count</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="spending-chart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">By Category</div>
        </div>
        <div class="chart-container">
          <canvas id="category-chart"></canvas>
        </div>
      </div>
    </div>

    <!-- Business Type Breakdown -->
    <div class="business-section">
      <div class="section-header">
        <div class="section-title">By Business Type</div>
      </div>
      <div class="business-grid" id="business-grid">
        <!-- Populated by JS -->
      </div>
    </div>

    <!-- Reports List -->
    <div class="reports-section">
      <div class="reports-tabs">
        <button class="reports-tab active" data-tab="all">
          All Reports <span class="count" id="tab-all-count">0</span>
        </button>
        <button class="reports-tab" data-tab="draft">
          Drafts <span class="count" id="tab-draft-count">0</span>
        </button>
        <button class="reports-tab" data-tab="submitted">
          Submitted <span class="count" id="tab-submitted-count">0</span>
        </button>
      </div>
      <div class="reports-toolbar">
        <div class="search-box">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
          <input type="text" placeholder="Search reports..." id="search-input" oninput="filterReports()">
        </div>
        <div class="toolbar-actions">
          <button class="toolbar-btn" onclick="exportAllReports()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export All
          </button>
        </div>
      </div>
      <div id="reports-list-container">
        <div class="loading-spinner">
          <div class="spinner"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- New Report Modal -->
  <div class="modal-overlay" id="new-report-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Create New Report</div>
        <button class="modal-close" onclick="hideNewReportModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Report Name</label>
          <input type="text" class="form-input" id="report-name" placeholder="e.g., December 2024 Expenses">
        </div>
        <div class="form-group">
          <label class="form-label">Business Type</label>
          <select class="form-select" id="report-business">
            <option value="all">All Business Types</option>
            <option value="Down Home">Down Home Media</option>
            <option value="Music City Rodeo">Music City Rodeo</option>
            <option value="Personal">Personal</option>
            <option value="EM.co">EM.co</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date From</label>
            <input type="date" class="form-input" id="report-date-from">
          </div>
          <div class="form-group">
            <label class="form-label">Date To</label>
            <input type="date" class="form-input" id="report-date-to">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="hideNewReportModal()">Cancel</button>
        <button class="btn-create" onclick="createNewReport()">Create Report</button>
      </div>
    </div>
  </div>

<script>
// ============================================
// REPORTS DASHBOARD JAVASCRIPT
// ============================================

let dashboardData = null;
let spendingChart = null;
let categoryChart = null;
let currentTab = 'all';

// Initialize dashboard
document.addEventListener('DOMContentLoaded', () => {
  loadDashboard();
  setupEventListeners();
  setDefaultDates();
});

function setupEventListeners() {
  // Tab clicks
  document.querySelectorAll('.reports-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.reports-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      currentTab = tab.dataset.tab;
      renderReportsList();
    });
  });

  // Chart toggle
  document.querySelectorAll('.chart-toggle-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.chart-toggle-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      updateSpendingChart(btn.dataset.view);
    });
  });

  // Date range selector
  document.querySelectorAll('.date-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.date-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      // Could reload data with different date range
    });
  });
}

function setDefaultDates() {
  const today = new Date();
  const firstOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
  document.getElementById('report-date-from').value = firstOfMonth.toISOString().split('T')[0];
  document.getElementById('report-date-to').value = today.toISOString().split('T')[0];
}

async function loadDashboard() {
  try {
    const response = await fetch('/api/reports/dashboard');
    if (!response.ok) throw new Error('Failed to load dashboard');
    dashboardData = await response.json();

    renderStats();
    renderCharts();
    renderBusinessBreakdown();
    renderReportsList();
  } catch (error) {
    console.error('Dashboard load error:', error);
    // Show error state
  }
}

function renderStats() {
  const ytd = dashboardData.ytd;

  document.getElementById('stat-total-amount').textContent = formatCurrency(ytd.total_amount);
  document.getElementById('stat-total-count').textContent = ytd.total_transactions.toLocaleString();
  document.getElementById('stat-report-count').textContent = ytd.report_count;
  document.getElementById('stat-reports-month').textContent = ytd.reports_this_month;
  document.getElementById('stat-coverage').textContent = Math.round(ytd.receipt_coverage) + '%';
  document.getElementById('stat-missing-count').textContent = ytd.missing_receipts;
  document.getElementById('stat-pending').textContent = ytd.pending_review;
}

function renderCharts() {
  renderSpendingChart();
  renderCategoryChart();
}

function renderSpendingChart() {
  const ctx = document.getElementById('spending-chart').getContext('2d');
  const data = dashboardData.monthly_trend;

  if (spendingChart) spendingChart.destroy();

  spendingChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: data.map(d => d.month),
      datasets: [{
        label: 'Spending',
        data: data.map(d => d.amount),
        backgroundColor: 'rgba(0, 255, 136, 0.3)',
        borderColor: '#00ff88',
        borderWidth: 2,
        borderRadius: 6,
        barPercentage: 0.6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1a1a1a',
          titleColor: '#fff',
          bodyColor: '#888',
          borderColor: '#333',
          borderWidth: 1,
          cornerRadius: 8,
          callbacks: {
            label: (ctx) => formatCurrency(ctx.raw)
          }
        }
      },
      scales: {
        x: {
          grid: { display: false },
          ticks: { color: '#666' }
        },
        y: {
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: {
            color: '#666',
            callback: (v) => '$' + (v/1000).toFixed(0) + 'k'
          }
        }
      }
    }
  });
}

function updateSpendingChart(view) {
  const data = dashboardData.monthly_trend;
  spendingChart.data.datasets[0].data = data.map(d => view === 'count' ? d.count : d.amount);
  spendingChart.options.scales.y.ticks.callback = view === 'count'
    ? (v) => v
    : (v) => '$' + (v/1000).toFixed(0) + 'k';
  spendingChart.update();
}

function renderCategoryChart() {
  const ctx = document.getElementById('category-chart').getContext('2d');
  const data = dashboardData.by_category.slice(0, 6);

  if (categoryChart) categoryChart.destroy();

  const colors = [
    '#00ff88', '#00cc6a', '#ffd85e', '#6eb5ff', '#ff8ea4', '#b388ff'
  ];

  categoryChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: data.map(d => d.name),
      datasets: [{
        data: data.map(d => d.amount),
        backgroundColor: colors,
        borderWidth: 0,
        spacing: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '65%',
      plugins: {
        legend: {
          position: 'right',
          labels: {
            color: '#888',
            font: { size: 11 },
            boxWidth: 12,
            padding: 8
          }
        },
        tooltip: {
          backgroundColor: '#1a1a1a',
          titleColor: '#fff',
          bodyColor: '#888',
          borderColor: '#333',
          borderWidth: 1,
          cornerRadius: 8,
          callbacks: {
            label: (ctx) => formatCurrency(ctx.raw)
          }
        }
      }
    }
  });
}

function renderBusinessBreakdown() {
  const container = document.getElementById('business-grid');
  const byBusiness = dashboardData.by_business;

  const total = Object.values(byBusiness).reduce((sum, b) => sum + b.total, 0);

  const businessColors = {
    'Down Home': 'down-home',
    'Music City Rodeo': 'mcr',
    'Personal': 'personal'
  };

  let html = '';
  Object.entries(byBusiness)
    .sort((a, b) => b[1].total - a[1].total)
    .forEach(([name, data]) => {
      const percent = total > 0 ? ((data.total / total) * 100).toFixed(0) : 0;
      const badgeClass = businessColors[name] || 'other';

      html += `
        <div class="business-card" onclick="filterByBusiness('${name}')">
          <div class="business-card-header">
            <div class="business-name">${name}</div>
            <span class="business-badge ${badgeClass}">${percent}%</span>
          </div>
          <div class="business-amount">${formatCurrency(data.total)}</div>
          <div class="business-meta">
            <span class="business-count">${data.count} transactions</span>
            <span class="business-percent">${percent}% of total</span>
          </div>
          <div class="business-bar" style="width: ${percent}%"></div>
        </div>
      `;
    });

  container.innerHTML = html;
}

function renderReportsList() {
  const container = document.getElementById('reports-list-container');
  let reports = dashboardData.recent_reports || [];

  // Filter by tab
  if (currentTab === 'draft') {
    reports = reports.filter(r => r.status === 'draft');
  } else if (currentTab === 'submitted') {
    reports = reports.filter(r => r.status === 'submitted');
  }

  // Update tab counts
  const allReports = dashboardData.recent_reports || [];
  document.getElementById('tab-all-count').textContent = allReports.length;
  document.getElementById('tab-draft-count').textContent = allReports.filter(r => r.status === 'draft').length;
  document.getElementById('tab-submitted-count').textContent = allReports.filter(r => r.status === 'submitted').length;

  if (reports.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">ðŸ“Š</div>
        <div class="empty-title">No Reports Yet</div>
        <div class="empty-text">Create your first expense report to start tracking your business expenses.</div>
        <button class="btn-new-report" onclick="showNewReportModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Create Report
        </button>
      </div>
    `;
    return;
  }

  let html = `
    <table class="reports-table">
      <thead>
        <tr>
          <th class="sortable">Report Name</th>
          <th class="sortable">Date</th>
          <th class="sortable">Amount</th>
          <th>Items</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
  `;

  reports.forEach(report => {
    const statusClass = report.status === 'submitted' ? 'submitted' : 'draft';
    const statusText = report.status === 'submitted' ? 'Submitted' : 'Draft';
    const date = report.submitted_at || report.created_at;
    const formattedDate = date ? new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '-';

    html += `
      <tr onclick="viewReport('${report.report_id}')">
        <td><span class="report-name">${report.name || 'Untitled Report'}</span></td>
        <td><span class="report-date">${formattedDate}</span></td>
        <td><span class="report-amount">${formatCurrency(report.total_amount)}</span></td>
        <td><span class="report-count">${report.expense_count} items</span></td>
        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
        <td>
          <div class="report-actions">
            <button class="action-btn" onclick="event.stopPropagation(); exportReport('${report.report_id}')" title="Export">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            </button>
            <button class="action-btn" onclick="event.stopPropagation(); deleteReport('${report.report_id}')" title="Delete">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            </button>
          </div>
        </td>
      </tr>
    `;
  });

  html += '</tbody></table>';
  container.innerHTML = html;
}

function filterReports() {
  const query = document.getElementById('search-input').value.toLowerCase();
  // Filter logic would go here
  renderReportsList();
}

function filterByBusiness(businessType) {
  // Navigate to viewer with business filter
  window.location.href = `/viewer?business=${encodeURIComponent(businessType)}`;
}

// Modal functions
function showNewReportModal() {
  document.getElementById('new-report-modal').classList.add('visible');
}

function hideNewReportModal() {
  document.getElementById('new-report-modal').classList.remove('visible');
}

async function createNewReport() {
  const name = document.getElementById('report-name').value;
  const business = document.getElementById('report-business').value;
  const dateFrom = document.getElementById('report-date-from').value;
  const dateTo = document.getElementById('report-date-to').value;

  if (!name) {
    alert('Please enter a report name');
    return;
  }

  try {
    const response = await fetch('/api/reports', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        name,
        business_type: business === 'all' ? null : business,
        date_from: dateFrom,
        date_to: dateTo
      })
    });

    if (!response.ok) throw new Error('Failed to create report');

    const data = await response.json();
    hideNewReportModal();

    // Navigate to viewer to build the report
    window.location.href = `/viewer?report=${data.report_id}`;
  } catch (error) {
    console.error('Create report error:', error);
    alert('Failed to create report');
  }
}

function viewReport(reportId) {
  window.location.href = `/reports/${reportId}/page`;
}

async function exportReport(reportId) {
  window.location.href = `/reports/${reportId}/export/downhome`;
}

async function deleteReport(reportId) {
  if (!confirm('Are you sure you want to delete this report?')) return;

  try {
    const response = await fetch(`/api/reports/${reportId}`, { method: 'DELETE' });
    if (!response.ok) throw new Error('Failed to delete');
    loadDashboard();
  } catch (error) {
    console.error('Delete error:', error);
    alert('Failed to delete report');
  }
}

function exportAllReports() {
  alert('Export all reports - Coming soon!');
}

// Utility functions
function formatCurrency(amount) {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0
  }).format(amount || 0);
}
</script>
</body>
</html>
