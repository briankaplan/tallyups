<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a0a0f">
  <title>Receipt Library - ReceiptAI</title>
  <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/static/css/receipt_library.css">
  <style>
    /* CSS is now in external file, but keep critical inline styles */
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-tertiary: #1a1a24;
      --bg-hover: #22222e;
      --accent: #00ff88;
      --accent-dim: rgba(0, 255, 136, 0.12);
      --accent-glow: rgba(0, 255, 136, 0.3);
      --text-primary: #ffffff;
      --text-secondary: #a0a0b0;
      --text-muted: #606070;
      --border: #2a2a36;
      --border-light: #3a3a46;
      --danger: #ff4757;
      --warning: #ffa502;
      --success: #00ff88;
      --info: #64c8ff;
      --purple: #a55eea;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --sidebar-width: 260px;
      --header-height: 64px;
      --toolbar-height: 48px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
    }

    body.dark-mode {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-tertiary: #1a1a24;
    }

    body.light-mode {
      --bg-primary: #f5f5f7;
      --bg-secondary: #ffffff;
      --bg-tertiary: #e8e8ec;
      --bg-hover: #dcdce2;
      --text-primary: #1a1a1a;
      --text-secondary: #505060;
      --text-muted: #808090;
      --border: #d0d0d8;
      --border-light: #e0e0e8;
    }

    /* Layout */
    .app-container {
      display: flex;
      min-height: 100vh;
      padding-top: var(--safe-top);
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      position: fixed;
      top: var(--safe-top);
      left: 0;
      bottom: 0;
      z-index: 100;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }

    .sidebar.visible {
      transform: translateX(0);
    }

    @media (min-width: 1024px) {
      .sidebar {
        transform: translateX(0);
      }
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 20px;
      font-weight: 700;
    }

    .sidebar-logo svg {
      width: 32px;
      height: 32px;
      color: var(--accent);
    }

    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      padding: 16px 0;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      padding: 0 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 20px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
    }

    .nav-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--accent-dim);
      color: var(--accent);
    }

    .nav-item svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .nav-count {
      margin-left: auto;
      font-size: 12px;
      color: var(--text-muted);
      background: var(--bg-tertiary);
      padding: 2px 8px;
      border-radius: 10px;
    }

    .nav-count.warning {
      background: rgba(255, 165, 2, 0.2);
      color: var(--warning);
    }

    .business-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .business-dot.down-home { background: #00ff88; }
    .business-dot.mcr { background: #64c8ff; }
    .business-dot.personal { background: #a55eea; }
    .business-dot.ceo { background: #ffa502; }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 0;
      display: flex;
      flex-direction: column;
    }

    @media (min-width: 1024px) {
      .main-content {
        margin-left: var(--sidebar-width);
      }
    }

    /* Header */
    .header {
      height: var(--header-height);
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 20px;
      gap: 16px;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .menu-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
    }

    .menu-btn:hover {
      background: var(--bg-hover);
    }

    @media (min-width: 1024px) {
      .menu-btn {
        display: none;
      }
    }

    /* Top Navigation Links */
    .nav-links {
      display: none;
      gap: 4px;
    }

    @media (min-width: 1024px) {
      .nav-links {
        display: flex;
      }
    }

    .nav-link-btn {
      padding: 8px 14px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 13px;
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid transparent;
      transition: all 0.15s;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .nav-link-btn:hover {
      background: var(--accent-dim);
      color: var(--text-primary);
    }

    .nav-link-btn.active {
      background: var(--accent-dim);
      color: var(--accent);
      border-color: rgba(0, 255, 136, 0.2);
    }

    .nav-link-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Search */
    .search-container {
      flex: 1;
      max-width: 600px;
      position: relative;
    }

    .search-input {
      width: 100%;
      height: 44px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0 44px;
      font-size: 15px;
      color: var(--text-primary);
      outline: none;
      transition: all 0.2s;
    }

    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
    }

    .search-clear {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--bg-hover);
      border: none;
      color: var(--text-secondary);
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .search-clear.visible {
      display: flex;
    }

    .search-shortcut {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
      color: var(--text-muted);
      background: var(--bg-hover);
      padding: 4px 8px;
      border-radius: 4px;
      font-family: monospace;
    }

    /* Header Actions */
    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-btn {
      width: 40px;
      height: 40px;
      border: 1px solid var(--border);
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      transition: all 0.2s;
    }

    .header-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .header-btn.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #000;
    }

    .header-btn.primary:hover {
      background: #00cc6e;
    }

    .view-toggle {
      display: flex;
      background: var(--bg-tertiary);
      border-radius: 10px;
      padding: 4px;
      gap: 4px;
    }

    .view-btn {
      width: 36px;
      height: 32px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .view-btn.active {
      background: var(--accent);
      color: #000;
    }

    /* Toolbar */
    .toolbar {
      height: var(--toolbar-height);
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
    }

    .toolbar-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .results-count {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .total-amount {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
    }

    /* Filter Chips */
    .filter-chips {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 12px 20px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      scrollbar-width: none;
    }

    .filter-chips::-webkit-scrollbar {
      display: none;
    }

    .filter-chip {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .filter-chip:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .filter-chip.active {
      background: var(--accent-dim);
      border-color: var(--accent);
      color: var(--accent);
    }

    .chip-count {
      font-size: 11px;
      opacity: 0.8;
    }

    /* Receipt Grid */
    .receipts-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .receipt-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }

    @media (min-width: 768px) {
      .receipt-grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      }
    }

    @media (min-width: 1200px) {
      .receipt-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      }
    }

    .receipt-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
    }

    .receipt-card:hover {
      border-color: var(--border-light);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .receipt-card.selected {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-dim);
    }

    .receipt-thumb {
      position: relative;
      aspect-ratio: 4/3;
      background: var(--bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .receipt-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #fff;
    }

    .receipt-thumb.no-image {
      background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
    }

    .receipt-thumb .placeholder {
      color: var(--border);
    }

    .receipt-badges {
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge.source { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); }
    .badge.source.gmail { color: #ea4335; }
    .badge.source.scanner { color: var(--accent); }
    .badge.source.manual { color: var(--info); }

    .badge.status { }
    .badge.verified { background: rgba(0, 255, 136, 0.9); color: #000; }
    .badge.mismatch { background: rgba(255, 71, 87, 0.9); color: #fff; }
    .badge.needs-review { background: rgba(255, 165, 2, 0.9); color: #000; }

    .receipt-checkbox {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 6px;
      opacity: 0;
      transition: opacity 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .receipt-card:hover .receipt-checkbox {
      opacity: 1;
    }

    .receipt-card.selected .receipt-checkbox {
      opacity: 1;
      background: var(--accent);
      border-color: var(--accent);
    }

    .receipt-info {
      padding: 14px;
    }

    .receipt-merchant {
      font-size: 15px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 6px;
    }

    .receipt-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .receipt-amount {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent);
    }

    .receipt-amount.refund {
      color: var(--warning);
    }

    .receipt-date {
      font-size: 13px;
      color: var(--text-muted);
    }

    .receipt-business {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-muted);
    }

    /* List View */
    .receipt-list {
      display: none;
    }

    .receipt-list.active {
      display: block;
    }

    .receipt-grid.hidden {
      display: none;
    }

    .list-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.2s;
    }

    .list-item:hover {
      background: var(--bg-hover);
      margin: 0 -20px;
      padding: 14px 20px;
    }

    .list-thumb {
      width: 56px;
      height: 56px;
      border-radius: 10px;
      background: var(--bg-tertiary);
      overflow: hidden;
      flex-shrink: 0;
    }

    .list-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #fff;
    }

    .list-info {
      flex: 1;
      min-width: 0;
    }

    .list-merchant {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .list-meta {
      font-size: 13px;
      color: var(--text-muted);
      display: flex;
      gap: 12px;
    }

    .list-amount {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent);
    }

    /* Timeline View */
    .timeline-view {
      display: none;
    }

    .timeline-view.active {
      display: block;
    }

    .timeline-group {
      margin-bottom: 32px;
    }

    .timeline-date {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 16px;
      padding-left: 24px;
      position: relative;
    }

    .timeline-date::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      background: var(--accent);
      border-radius: 50%;
    }

    .timeline-items {
      padding-left: 24px;
      border-left: 2px solid var(--border);
      margin-left: 11px;
    }

    /* Empty State */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
      text-align: center;
    }

    .empty-state svg {
      width: 80px;
      height: 80px;
      color: var(--border);
      margin-bottom: 24px;
    }

    .empty-state h3 {
      font-size: 20px;
      margin-bottom: 8px;
    }

    .empty-state p {
      color: var(--text-muted);
      font-size: 14px;
      max-width: 300px;
    }

    .empty-action {
      margin-top: 24px;
      padding: 12px 24px;
      background: var(--accent);
      border: none;
      border-radius: 10px;
      color: #000;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Loading */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
      gap: 16px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Receipt Detail Modal */
    .detail-modal {
      position: fixed;
      inset: 0;
      background: var(--bg-primary);
      z-index: 200;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .detail-modal.visible {
      transform: translateX(0);
    }

    @media (min-width: 1024px) {
      .detail-modal {
        left: auto;
        width: 50%;
        max-width: 700px;
        border-left: 1px solid var(--border);
        box-shadow: -20px 0 60px rgba(0, 0, 0, 0.5);
      }
    }

    .detail-header {
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-secondary);
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: none;
      border: none;
      color: var(--accent);
      font-size: 15px;
      cursor: pointer;
      padding: 8px 0;
    }

    .detail-actions {
      display: flex;
      gap: 8px;
    }

    .detail-actions button {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .detail-actions button:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .detail-actions button.danger:hover {
      background: rgba(255, 71, 87, 0.2);
      color: var(--danger);
      border-color: var(--danger);
    }

    .detail-body {
      flex: 1;
      overflow-y: auto;
    }

    .detail-image {
      background: var(--bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 300px;
      max-height: 50vh;
      overflow: hidden;
    }

    .detail-image img {
      max-width: 100%;
      max-height: 50vh;
      object-fit: contain;
      background: #fff;
    }

    .detail-image.no-image {
      height: 200px;
    }

    .detail-content {
      padding: 24px;
    }

    .detail-merchant {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .detail-source-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 20px;
    }

    .detail-amount {
      font-size: 42px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 24px;
    }

    .detail-amount.refund {
      color: var(--warning);
    }

    .detail-fields {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .detail-field {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .field-label {
      font-size: 14px;
      color: var(--text-muted);
    }

    .field-value {
      font-size: 15px;
      font-weight: 500;
      text-align: right;
      max-width: 60%;
      word-break: break-word;
    }

    .detail-notes {
      margin-top: 24px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .detail-notes h4 {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .detail-notes p {
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-secondary);
    }

    .detail-tags {
      margin-top: 24px;
    }

    .detail-tags h4 {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .tags-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .tag {
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 16px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .tag.add-tag {
      border-style: dashed;
      color: var(--text-muted);
      cursor: pointer;
    }

    .tag.add-tag:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    /* Filter Modal */
    .filter-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 150;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .filter-modal.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .filter-sheet {
      background: var(--bg-secondary);
      border-radius: 24px 24px 0 0;
      width: 100%;
      max-width: 500px;
      max-height: 85vh;
      padding: 24px;
      padding-bottom: calc(24px + var(--safe-bottom));
      transform: translateY(100%);
      transition: transform 0.3s ease;
      overflow-y: auto;
    }

    .filter-modal.visible .filter-sheet {
      transform: translateY(0);
    }

    .filter-sheet-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .filter-sheet-header h3 {
      font-size: 20px;
      font-weight: 600;
    }

    .filter-sheet-header button {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
    }

    .filter-section {
      margin-bottom: 24px;
    }

    .filter-section h4 {
      font-size: 13px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .filter-presets {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .filter-preset {
      padding: 10px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-preset:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .filter-preset.active {
      background: var(--accent-dim);
      border-color: var(--accent);
      color: var(--accent);
    }

    .filter-inputs {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    .filter-input-group {
      flex: 1;
    }

    .filter-input-group label {
      display: block;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .filter-input-group input {
      width: 100%;
      height: 48px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 0 14px;
      font-size: 16px;
      color: var(--text-primary);
      outline: none;
    }

    .filter-input-group input:focus {
      border-color: var(--accent);
    }

    .filter-apply {
      width: 100%;
      height: 52px;
      background: var(--accent);
      border: none;
      border-radius: 12px;
      color: #000;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 24px;
    }

    /* Upload Modal */
    .upload-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 200;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .upload-modal.visible {
      display: flex;
    }

    .upload-content {
      background: var(--bg-secondary);
      border-radius: 24px;
      width: 100%;
      max-width: 500px;
      padding: 32px;
    }

    .upload-dropzone {
      border: 2px dashed var(--border);
      border-radius: 16px;
      padding: 48px 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-dropzone:hover,
    .upload-dropzone.dragover {
      border-color: var(--accent);
      background: var(--accent-dim);
    }

    .upload-dropzone svg {
      width: 64px;
      height: 64px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .upload-dropzone h3 {
      font-size: 18px;
      margin-bottom: 8px;
    }

    .upload-dropzone p {
      color: var(--text-muted);
      font-size: 14px;
    }

    .upload-formats {
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Bottom Navigation (Mobile) */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: calc(60px + var(--safe-bottom));
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      padding-top: 8px;
      z-index: 100;
    }

    @media (min-width: 1024px) {
      .bottom-nav {
        display: none;
      }

      .main-content {
        padding-bottom: 0;
      }
    }

    .nav-link {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 10px;
      font-weight: 500;
      padding: 4px 12px;
      transition: color 0.2s;
    }

    .nav-link.active {
      color: var(--accent);
    }

    .nav-link svg {
      width: 24px;
      height: 24px;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: calc(80px + var(--safe-bottom));
      left: 50%;
      transform: translateX(-50%);
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    @media (min-width: 1024px) {
      .toast-container {
        bottom: 24px;
        right: 24px;
        left: auto;
        transform: none;
      }
    }

    .toast {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .toast.success {
      border-color: var(--success);
    }

    .toast.error {
      border-color: var(--danger);
    }

    /* Keyboard Shortcuts Modal */
    .shortcuts-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 250;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .shortcuts-modal.visible {
      display: flex;
    }

    .shortcuts-content {
      background: var(--bg-secondary);
      border-radius: 20px;
      padding: 32px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .shortcuts-content h2 {
      font-size: 24px;
      margin-bottom: 24px;
    }

    .shortcuts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
    }

    .shortcut-group h3 {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .shortcut {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      font-size: 14px;
    }

    .shortcut kbd {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 4px 8px;
      font-family: monospace;
      font-size: 12px;
    }

    /* Utilities */
    .hidden {
      display: none !important;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }
  </style>
</head>
<body class="dark-mode">
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H6v-2h6v2zm4-4H6v-2h10v2zm0-4H6V7h10v2z"/>
          </svg>
          Receipt Library
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Library</div>
          <a href="#" class="nav-item active" data-filter="all">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"></rect>
              <line x1="9" y1="9" x2="15" y2="9"></line>
              <line x1="9" y1="13" x2="15" y2="13"></line>
            </svg>
            <span>All Receipts</span>
            <span class="nav-count" id="count-all">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="favorites">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
            <span>Favorites</span>
            <span class="nav-count" id="count-favorites">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="recent">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>Recent</span>
            <span class="nav-count" id="count-recent">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="needs_review">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <span>Needs Review</span>
            <span class="nav-count warning" id="count-review">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="duplicates">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="8" y="8" width="12" height="12" rx="2"></rect>
              <rect x="4" y="4" width="12" height="12" rx="2"></rect>
            </svg>
            <span>Duplicates</span>
            <span class="nav-count" id="count-duplicates">0</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Business</div>
          <a href="#" class="nav-item" data-filter="business:down_home">
            <span class="business-dot down-home"></span>
            <span>Down Home</span>
            <span class="nav-count" id="count-down-home">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="business:mcr">
            <span class="business-dot mcr"></span>
            <span>Music City Rodeo</span>
            <span class="nav-count" id="count-mcr">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="business:personal">
            <span class="business-dot personal"></span>
            <span>Personal</span>
            <span class="nav-count" id="count-personal">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="business:ceo">
            <span class="business-dot ceo"></span>
            <span>CEO</span>
            <span class="nav-count" id="count-ceo">0</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Status</div>
          <a href="#" class="nav-item" data-filter="status:verified">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Verified</span>
            <span class="nav-count" id="count-verified">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="status:matched">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            <span>Matched</span>
            <span class="nav-count" id="count-matched">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="status:processing">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>Processing</span>
            <span class="nav-count" id="count-processing">0</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Source</div>
          <a href="#" class="nav-item" data-filter="source:gmail">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/>
            </svg>
            <span>Gmail</span>
            <span class="nav-count" id="count-gmail">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="source:scanner">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"></rect>
              <line x1="3" y1="9" x2="21" y2="9"></line>
            </svg>
            <span>Scanner</span>
            <span class="nav-count" id="count-scanner">0</span>
          </a>
          <a href="#" class="nav-item" data-filter="source:upload">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <span>Uploads</span>
            <span class="nav-count" id="count-upload">0</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <button class="menu-btn" id="menu-btn" aria-label="Menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>

        <!-- Desktop Navigation Links -->
        <nav class="nav-links">
          <a href="/" class="nav-link-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Home
          </a>
          <a href="/viewer" class="nav-link-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 11l3 3L22 4"></path>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            Reconcile
          </a>
          <a href="/library" class="nav-link-btn active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            Library
          </a>
          <a href="/scanner" class="nav-link-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
              <circle cx="12" cy="13" r="4"></circle>
            </svg>
            Scan
          </a>
          <a href="/incoming" class="nav-link-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline>
              <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path>
            </svg>
            Inbox
          </a>
          <a href="/reports" class="nav-link-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            Reports
          </a>
        </nav>

        <div class="search-container">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.3-4.3"></path>
          </svg>
          <input type="text" class="search-input" id="search-input" placeholder="Search receipts... (try 'coffee >$10 last-month')" autocomplete="off">
          <button class="search-clear" id="search-clear">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <span class="search-shortcut" id="search-shortcut">/</span>
        </div>

        <div class="header-actions">
          <div class="view-toggle">
            <button class="view-btn active" data-view="grid" title="Grid view">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <rect x="3" y="3" width="7" height="7" rx="1"></rect>
                <rect x="14" y="3" width="7" height="7" rx="1"></rect>
                <rect x="3" y="14" width="7" height="7" rx="1"></rect>
                <rect x="14" y="14" width="7" height="7" rx="1"></rect>
              </svg>
            </button>
            <button class="view-btn" data-view="list" title="List view">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <circle cx="4" cy="6" r="1" fill="currentColor"></circle>
                <circle cx="4" cy="12" r="1" fill="currentColor"></circle>
                <circle cx="4" cy="18" r="1" fill="currentColor"></circle>
              </svg>
            </button>
            <button class="view-btn" data-view="timeline" title="Timeline view">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="2" x2="12" y2="22"></line>
                <circle cx="12" cy="6" r="2"></circle>
                <circle cx="12" cy="12" r="2"></circle>
                <circle cx="12" cy="18" r="2"></circle>
              </svg>
            </button>
          </div>

          <button class="header-btn" id="filter-btn" title="Filters">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
          </button>

          <button class="header-btn" id="sort-btn" title="Sort">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M6 12h12M9 18h6"></path>
            </svg>
          </button>

          <button class="header-btn primary" id="upload-btn" title="Upload receipts">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
          </button>

          <button class="header-btn" id="theme-btn" title="Toggle theme">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
        </div>
      </header>

      <!-- Toolbar -->
      <div class="toolbar">
        <div class="toolbar-left">
          <span class="results-count" id="results-count">Loading...</span>
        </div>
        <div class="toolbar-right">
          <span class="total-amount" id="total-amount"></span>
        </div>
      </div>

      <!-- Filter Chips -->
      <div class="filter-chips" id="filter-chips">
        <button class="filter-chip active" data-filter="all">All</button>
        <button class="filter-chip" data-preset="today">Today</button>
        <button class="filter-chip" data-preset="week">This Week</button>
        <button class="filter-chip" data-preset="month">This Month</button>
        <button class="filter-chip" data-status="verified">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Verified
        </button>
        <button class="filter-chip" data-status="needs_review">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          Needs Review
        </button>
        <button class="filter-chip" data-status="mismatch">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          Mismatched
        </button>
      </div>

      <!-- Receipts Container -->
      <div class="receipts-container" id="receipts-container">
        <!-- Loading State -->
        <div class="loading-container" id="loading">
          <div class="loading-spinner"></div>
          <span>Loading receipts...</span>
        </div>

        <!-- Receipt Grid -->
        <div class="receipt-grid" id="receipt-grid"></div>

        <!-- Receipt List -->
        <div class="receipt-list" id="receipt-list"></div>

        <!-- Timeline View -->
        <div class="timeline-view" id="timeline-view"></div>

        <!-- Empty State -->
        <div class="empty-state hidden" id="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path>
            <rect x="9" y="3" width="6" height="4" rx="1"></rect>
            <path d="M9 14l2 2 4-4"></path>
          </svg>
          <h3 id="empty-title">No receipts found</h3>
          <p id="empty-message">Try adjusting your filters or upload some receipts</p>
          <button class="empty-action" id="empty-upload-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            Upload Receipts
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- Detail Modal -->
  <div class="detail-modal" id="detail-modal">
    <div class="detail-header">
      <button class="back-btn" id="detail-close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m15 18-6-6 6-6"></path>
        </svg>
        Library
      </button>
      <div class="detail-actions">
        <button id="detail-favorite" title="Favorite">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
          </svg>
        </button>
        <button id="detail-download" title="Download">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        </button>
        <button id="detail-share" title="Share">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
            <polyline points="16 6 12 2 8 6"></polyline>
            <line x1="12" y1="2" x2="12" y2="15"></line>
          </svg>
        </button>
        <button id="detail-delete" class="danger" title="Delete">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </button>
      </div>
    </div>

    <div class="detail-body">
      <div class="detail-image" id="detail-image">
        <img id="detail-img" src="" alt="Receipt">
      </div>

      <div class="detail-content">
        <h1 class="detail-merchant" id="detail-merchant"></h1>
        <div class="detail-source-badge" id="detail-source"></div>
        <div class="detail-amount" id="detail-amount"></div>

        <div class="detail-fields" id="detail-fields">
          <div class="detail-field">
            <span class="field-label">Date</span>
            <span class="field-value" id="detail-date"></span>
          </div>
          <div class="detail-field">
            <span class="field-label">Business</span>
            <span class="field-value" id="detail-business"></span>
          </div>
          <div class="detail-field">
            <span class="field-label">Status</span>
            <span class="field-value" id="detail-status"></span>
          </div>
          <div class="detail-field" id="field-card" style="display: none;">
            <span class="field-label">Card</span>
            <span class="field-value" id="detail-card"></span>
          </div>
          <div class="detail-field" id="field-category" style="display: none;">
            <span class="field-label">Category</span>
            <span class="field-value" id="detail-category"></span>
          </div>
        </div>

        <div class="detail-notes" id="detail-notes" style="display: none;">
          <h4>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            AI Notes
          </h4>
          <p id="detail-notes-text"></p>
        </div>

        <div class="detail-tags" id="detail-tags-section">
          <h4>Tags</h4>
          <div class="tags-list" id="detail-tags">
            <span class="tag add-tag">+ Add tag</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Modal -->
  <div class="filter-modal" id="filter-modal">
    <div class="filter-sheet">
      <div class="filter-sheet-header">
        <h3>Filters</h3>
        <button id="filter-modal-close">Done</button>
      </div>

      <div class="filter-section">
        <h4>Date Range</h4>
        <div class="filter-presets">
          <button class="filter-preset" data-preset="today">Today</button>
          <button class="filter-preset" data-preset="week">This Week</button>
          <button class="filter-preset" data-preset="month">This Month</button>
          <button class="filter-preset" data-preset="quarter">90 Days</button>
          <button class="filter-preset" data-preset="year">This Year</button>
          <button class="filter-preset" data-preset="all">All Time</button>
        </div>
        <div class="filter-inputs">
          <div class="filter-input-group">
            <label>From</label>
            <input type="date" id="filter-date-from">
          </div>
          <div class="filter-input-group">
            <label>To</label>
            <input type="date" id="filter-date-to">
          </div>
        </div>
      </div>

      <div class="filter-section">
        <h4>Amount Range</h4>
        <div class="filter-presets">
          <button class="filter-preset" data-amount="0-25">Under $25</button>
          <button class="filter-preset" data-amount="25-100">$25 - $100</button>
          <button class="filter-preset" data-amount="100-500">$100 - $500</button>
          <button class="filter-preset" data-amount="500+">$500+</button>
        </div>
        <div class="filter-inputs">
          <div class="filter-input-group">
            <label>Min</label>
            <input type="number" id="filter-amount-min" placeholder="$0" step="0.01">
          </div>
          <div class="filter-input-group">
            <label>Max</label>
            <input type="number" id="filter-amount-max" placeholder="Any" step="0.01">
          </div>
        </div>
      </div>

      <button class="filter-apply" id="filter-apply">Apply Filters</button>
    </div>
  </div>

  <!-- Sort Modal -->
  <div class="filter-modal" id="sort-modal">
    <div class="filter-sheet">
      <div class="filter-sheet-header">
        <h3>Sort By</h3>
        <button id="sort-modal-close">Done</button>
      </div>

      <div class="filter-presets" style="flex-direction: column;">
        <button class="filter-preset active" data-sort="date_desc">Newest First</button>
        <button class="filter-preset" data-sort="date_asc">Oldest First</button>
        <button class="filter-preset" data-sort="amount_desc">Highest Amount</button>
        <button class="filter-preset" data-sort="amount_asc">Lowest Amount</button>
        <button class="filter-preset" data-sort="merchant_asc">Merchant A-Z</button>
      </div>
    </div>
  </div>

  <!-- Upload Modal -->
  <div class="upload-modal" id="upload-modal">
    <div class="upload-content">
      <div class="upload-dropzone" id="upload-dropzone">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        <h3>Drop receipts here</h3>
        <p>or click to browse</p>
        <p class="upload-formats">JPG, PNG, PDF, HEIC supported</p>
        <input type="file" id="file-input" multiple accept="image/*,.pdf,.heic" style="display: none;">
      </div>
    </div>
  </div>

  <!-- Keyboard Shortcuts Modal -->
  <div class="shortcuts-modal" id="shortcuts-modal">
    <div class="shortcuts-content">
      <h2>Keyboard Shortcuts</h2>
      <div class="shortcuts-grid">
        <div class="shortcut-group">
          <h3>Navigation</h3>
          <div class="shortcut"><span><kbd>J</kbd> / <kbd>K</kbd></span> <span>Next / Prev</span></div>
          <div class="shortcut"><span><kbd>Enter</kbd></span> <span>Open receipt</span></div>
          <div class="shortcut"><span><kbd>Esc</kbd></span> <span>Close / Back</span></div>
        </div>
        <div class="shortcut-group">
          <h3>Actions</h3>
          <div class="shortcut"><span><kbd>/</kbd></span> <span>Search</span></div>
          <div class="shortcut"><span><kbd>F</kbd></span> <span>Favorite</span></div>
          <div class="shortcut"><span><kbd>D</kbd></span> <span>Download</span></div>
        </div>
        <div class="shortcut-group">
          <h3>Views</h3>
          <div class="shortcut"><span><kbd>1</kbd></span> <span>Grid view</span></div>
          <div class="shortcut"><span><kbd>2</kbd></span> <span>List view</span></div>
          <div class="shortcut"><span><kbd>3</kbd></span> <span>Timeline</span></div>
        </div>
        <div class="shortcut-group">
          <h3>Help</h3>
          <div class="shortcut"><span><kbd>?</kbd></span> <span>Show shortcuts</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Bottom Navigation (Mobile) -->
  <nav class="bottom-nav">
    <a href="/" class="nav-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>Home</span>
    </a>
    <a href="/viewer" class="nav-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 11l3 3L22 4"></path>
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
      </svg>
      <span>Reconcile</span>
    </a>
    <a href="/library" class="nav-link active">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      <span>Library</span>
    </a>
    <a href="/scanner" class="nav-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
        <circle cx="12" cy="13" r="4"></circle>
      </svg>
      <span>Scan</span>
    </a>
    <a href="/incoming" class="nav-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline>
        <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path>
      </svg>
      <span>Inbox</span>
    </a>
  </nav>

  <script src="/static/js/receipt_library.js"></script>
</body>
</html>
